
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Study of populations</title><meta name="generator" content="MATLAB 9.0"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2018-04-06"><meta name="DC.source" content="pop.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Study of populations</h1><!--introduction--><p>Here we evaluate a a physhical model of a car going forward taking in account different values of the contant of time which is given by the friction constant divided by mass</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Load model</a></li><li><a href="#3">Variable Definition</a></li><li><a href="#4">2.1</a></li><li><a href="#5">2.2</a></li><li><a href="#15">2.3</a></li><li><a href="#17">2.4 a)</a></li><li><a href="#19">2.4 b)</a></li><li><a href="#21">2.4 c)</a></li><li><a href="#22">2.4 c)</a></li></ul></div><h2>Load model<a name="1"></a></h2><pre class="codeinput"><span class="keyword">function</span> pop
</pre><pre class="codeinput">close <span class="string">all</span>;
<span class="comment">%Load file in system memory</span>
file=<span class="string">'popul'</span>;
load_system(file);
</pre><h2>Variable Definition<a name="3"></a></h2><pre class="codeinput">StopTime=<span class="string">'4'</span>;
N1_init=<span class="string">'2'</span>;
N2_init=<span class="string">'2'</span>;
alpha1=1;
alpha2=1;
legenda1=<span class="string">'Predadator (N2)'</span>;
legenda2=<span class="string">'Prey (N1)'</span>;
xaxe=<span class="string">'Time (s)'</span>;
yaxe=<span class="string">'[Predadator (N2),Prey (N1)]'</span>;

<span class="comment">%Define strings to input into model</span>
</pre><h2>2.1<a name="4"></a></h2><p>Simulations with <img src="pop_eq08572897854136196510.png" alt="$$\alpha_1 = \alpha_2 $$"> and for various values of <img src="pop_eq13722326819909097475.png" alt="$$\sigma_1 $$"> and <img src="pop_eq17059583732296717141.png" alt="$$\sigma_2 $$"></p><h2>2.2<a name="5"></a></h2><p>With <img src="pop_eq08106402685485405620.png" alt="$$\alpha_1 = \alpha_2 = 1 $$"> we evaluate the different types of evolution considering various values for <img src="pop_eq13122949308840860700.png" alt="$$\delta_1 $$"> and <img src="pop_eq02337132093958016198.png" alt="$$\delta_2 $$"></p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'10'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,-1,-1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = -1 and \delta_2 = -1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_01.png" alt=""> <p><img src="pop_eq14785143215395248422.png" alt="$$\delta_1 = -1 $$"> and <img src="pop_eq02563430738935303377.png" alt="$$\delta_2 = -1 $$">  osccilates</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,StopTime,<span class="string">'0.0001'</span>,N1_init,N2_init,file,-1,0);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = -1 and \delta_2 = 0'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_02.png" alt=""> <p><img src="pop_eq14785143215395248422.png" alt="$$\delta_1 = -1 $$"> and <img src="pop_eq02228438658146341448.png" alt="$$\delta_2 = 0 $$"> equilibrium</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'2'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,-1,1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = -1 and \delta_2 = 1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_03.png" alt=""> <p><img src="pop_eq15815052529038162368.png" alt="$$\delta_1 = -1 $$ and $$\delta_2 = 1 $$"></p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'10'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,0,-1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 0 and \delta_2 = -1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_04.png" alt=""> <p><img src="pop_eq15812451524176165374.png" alt="$$\delta_1 = 0 $$"> and <img src="pop_eq02563430738935303377.png" alt="$$\delta_2 = -1 $$">  osccilates</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,StopTime,<span class="string">'0.0001'</span>,N1_init,N2_init,file,0,0);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 0 and \delta_2 = 0'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_05.png" alt=""> <p><img src="pop_eq15812451524176165374.png" alt="$$\delta_1 = 0 $$"> and <img src="pop_eq02228438658146341448.png" alt="$$\delta_2 = 0 $$"> equilibrium</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'2'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,0,1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 0 and \delta_2 = 1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_06.png" alt=""> <p><img src="pop_eq16000934495800968534.png" alt="$$\delta_1 = 0 $$ and $$\delta_2 = 1 $$"></p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'10'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,1,-1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 1 and \delta_2 = -1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_07.png" alt=""> <p><img src="pop_eq11958663548107639564.png" alt="$$\delta_1 = 1 $$"> and <img src="pop_eq02563430738935303377.png" alt="$$\delta_2 = -1 $$">  osccilates</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,StopTime,<span class="string">'0.0001'</span>,N1_init,N2_init,file,1,0);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 1 and \delta_2 = 0'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_08.png" alt=""> <p><img src="pop_eq11958663548107639564.png" alt="$$\delta_1 = 1 $$"> and <img src="pop_eq02228438658146341448.png" alt="$$\delta_2 = 0 $$"> equilibrium</p><pre class="codeinput">mod=sim_plot(alpha1,alpha2,<span class="string">'2'</span>,<span class="string">'0.0001'</span>,N1_init,N2_init,file,1,1);
tittle=<span class="string">'Interaction between the two populations with \delta_1 = 1 and \delta_2 = 1'</span>;
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
</pre><img vspace="5" hspace="5" src="pop_09.png" alt=""> <p><img src="pop_eq18324777375169989856.png" alt="$$\delta_1 = 1 $$ and $$\delta_2 = 1 $$"></p><h2>2.3<a name="15"></a></h2><p>To confirm equilibrium we need to assure that <img src="pop_eq10680663764354241954.png" alt="$$N_1 = -\frac{\delta_2}{\alpha_2} $$"> and <img src="pop_eq12002139907698268635.png" alt="$$\frac{\delta_1}{\alpha_1} $$">, so ploting the case where the populations osccilate i.e for every <img src="pop_eq07154945909053325366.png" alt="$$\delta_2 < 0 $$"> with <img src="pop_eq05673647097858741621.png" alt="$$\delta_1 &gt;0 $$"></p><pre class="codeinput">    n1V=[1 2 3 4 5 6]
    n2V=[1 2 3 4 5 6]
    [X,Y]=meshgrid(n1V,n2V);
figure
grid <span class="string">on</span>;
grid <span class="string">minor</span>;
<span class="keyword">for</span> k=1:6
    <span class="keyword">for</span> j=1:6
        mod=sim_plot(alpha1,alpha2,<span class="string">'10'</span>,<span class="string">'0.0001'</span>,X(k,j),Y(k,j),file,1,-1);
        N2p=mod.get(<span class="string">'dataN2'</span>);
        N1p=mod.get(<span class="string">'dataN1'</span>);
        plot(N1p,N2p,<span class="string">'linewidth'</span>,2);
        hold <span class="string">on</span>;
        xlabel(<span class="string">'N2 Population'</span>);
        ylabel(<span class="string">'N1 Population'</span>);
        title(<span class="string">'Phase Space with \delta_1 = 1 and \delta_2 = -1'</span>,<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>);

    <span class="keyword">end</span>
<span class="keyword">end</span>
mod=sim_plot(alpha1,alpha2,<span class="string">'10'</span>,<span class="string">'0.0001'</span>,1,1,file,1,-1);
N2p=mod.get(<span class="string">'dataN2'</span>);
N1p=mod.get(<span class="string">'dataN1'</span>);
plot(N1p,N2p,<span class="string">'x'</span>,<span class="string">'linewidth'</span>,2);
hold <span class="string">off</span>
<span class="comment">%Por acabar</span>
</pre><pre class="codeoutput">
n1V =

     1     2     3     4     5     6


n2V =

     1     2     3     4     5     6

</pre><img vspace="5" hspace="5" src="pop_10.png" alt=""> <p>comentar que temos sempre o equilibrio se o ponto de equilibrio for satisfeito</p><h2>2.4 a)<a name="17"></a></h2><p>Here we plot presas.mat togeter with our best guess of values for the predadotr evolution</p><pre class="codeinput">mod=sim_plot(1.4,0.71,<span class="string">'20'</span>,<span class="string">'0.0001'</span>,<span class="string">'4'</span>,<span class="string">'1.47'</span>,file,3.1,-1.5);
<span class="comment">%plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);</span>

prey=load(<span class="string">'presas.mat'</span>);
h=plot(prey.tr,prey.yr,<span class="string">'linewidth'</span>,2);
N1=mod.get(<span class="string">'dataN1'</span>);
clk=mod.get(<span class="string">'clock'</span>);
hold <span class="string">on</span>;
h1=plot(clk,N1,<span class="string">'linewidth'</span>,2);
grid <span class="string">on</span>;
grid <span class="string">minor</span>;
xlabel(<span class="string">'Time (s)'</span>);
ylabel(<span class="string">'N1 Population'</span>);
title(<span class="string">'Approximation by visual guidance'</span>,<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>);
legend([h,h1],<span class="string">'N1 given by file'</span>,<span class="string">'N1 by visual approximation'</span>);
hold <span class="string">off</span>
</pre><img vspace="5" hspace="5" src="pop_11.png" alt=""> <p>We can see by the maximum values of presas.mat that our values for the predadator function are a good estimate of the real ones</p><h2>2.4 b)<a name="19"></a></h2><pre class="codeinput"><span class="comment">%Get linear spaced values for variables (400 iterations using 20 by 20 linear spaced)</span>
alpha2_t=linspace(0.68,0.72,20);
N2_t=linspace(1.58,1.62,20);
[X,Y]=meshgrid(alpha2_t,N2_t);
<span class="comment">%Z matrix contains the total error for each point of the grid</span>
Z = error_matrix(alpha2_t,N2_t);

<span class="comment">%Plot mesh figure</span>
h=figure;
create_mesh(h,X,Y,Z);    <span class="comment">%made by righ clicking the figure (../get code) because i rotated it to get a better view</span>
<span class="comment">%Get the min error value and index</span>
I=find(Z==min(min(Z)));
Zmin=min(min(Z));
N2_init=num2str(Y(I));
alpha_2=num2str(X(I));

<span class="comment">%Plot both prey evolution plot</span>
mod=sim_plot(1.4,alpha_2,<span class="string">'20'</span>,<span class="string">'0.0001'</span>,<span class="string">'4'</span>,N2_init,file,3.1,-1.5);
N1=mod.get(<span class="string">'dataN1'</span>);
clk=mod.get(<span class="string">'clock'</span>);
figure
<span class="comment">%plot presas.mat</span>
h=plot(prey.tr,prey.yr,<span class="string">'linewidth'</span>,2);
hold <span class="string">on</span>;
<span class="comment">%plot sim and label</span>
h1=plot(clk,N1,<span class="string">'linewidth'</span>,2);
xlabel(<span class="string">'Time (s)'</span>);
ylabel(<span class="string">'N1 Population'</span>);
title(<span class="string">'Approximation by brute force'</span>,<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>);
legend([h,h1],<span class="string">'N1 given by file'</span>,<span class="string">'N1 by approximation'</span>);
grid <span class="string">on</span>;
grid <span class="string">minor</span>;
hold <span class="string">off</span>;
<span class="comment">%Get min value of error and point X,Y</span>
N2_init=num2str(Y(I));
alpha_2=num2str(X(I));
Zmin_str=num2str(Zmin);
message=sprintf(<span class="string">'By this method, using 400 iterations we get N(0)=%s and alpha_2 =%s as our best values for aproximation, with a total error of %s'</span>,N2_init,alpha_2,Zmin_str);
disp(message);
</pre><pre class="codeoutput">By this method, using 400 iterations we get N(0)=1.5968 and alpha_2 =0.70105 as our best values for aproximation, with a total error of 9.9726
</pre><img vspace="5" hspace="5" src="pop_12.png" alt=""> <img vspace="5" hspace="5" src="pop_13.png" alt=""> <p>Using brute force iterations we see that we can get a really good approximation. But if we didnt knew the interval on where alpha2 and N2init were, we would get much more iteration. This method is not viable (continue)</p><h2>2.4 c)<a name="21"></a></h2><p>Optimization usig fminsearch</p><pre class="codeinput"><span class="comment">%x0 = initial values to begin optimization algorithm, fminsearch returns</span>
<span class="comment">%the solution fval (error in our case), x(1) and x(2) corresponding to</span>
<span class="comment">%N2_init and alpha_2</span>
x0=[0.68;1.58];
options=optimset(<span class="string">'Display'</span>,<span class="string">'final'</span>);
[x,fval,exitflag,output]=fminsearch(@algorithm1,x0,options);
<span class="comment">%get number of iterations it needed to find the min value</span>
iterations=output.iterations
fval_str=num2str(fval);

message=sprintf(<span class="string">'By this method using 28 iterations we get N(0)=%s and alpha_2 =%s as our best values for aproximation, with a total error of %s'</span>,x(2),x(1),fval_str);
disp(message);
<span class="comment">%plot both prey evolution plots</span>
N2_init=num2str(x(2));
alpha_2=num2str(x(1));
mod=sim_plot(1.4,alpha_2,<span class="string">'20'</span>,<span class="string">'0.0001'</span>,<span class="string">'4'</span>,N2_init,file,3.1,-1.5);
N1_f=mod.get(<span class="string">'dataN1'</span>);
clk_f=mod.get(<span class="string">'clock'</span>);
figure
h=plot(prey.tr,prey.yr,<span class="string">'linewidth'</span>,2);
hold <span class="string">on</span>
h2=plot(clk_f,N1_f,<span class="string">'linewidth'</span>,2);
xlabel(<span class="string">'Time (s)'</span>);
ylabel(<span class="string">'N1 Population'</span>);
title(<span class="string">'Approximation using optimization algorithm'</span>,<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>);
legend([h,h2],<span class="string">'N1 given by file'</span>,<span class="string">'N1 by approximation'</span>);
grid <span class="string">on</span>;
grid <span class="string">minor</span>;
hold <span class="string">off</span>;

result=Zmin-fval;
<span class="keyword">if</span> result&lt;0
    message=sprintf(<span class="string">'Brute force iteration gives a better result with a difference of %f on the total error'</span>,result)
<span class="keyword">elseif</span> result &gt; 0
    message=sprintf(<span class="string">'fminsearch gives a better result with a difference of %f on the total error'</span>,result)
<span class="keyword">else</span>
    message=sprintf(<span class="string">'Both methonds give the same result, given the %f difference on the total error'</span>,result)
<span class="keyword">end</span>
</pre><pre class="codeoutput"> 
Optimization terminated:
 the current x satisfies the termination criteria using OPTIONS.TolX of 1.000000e-04 
 and F(X) satisfies the convergence criteria using OPTIONS.TolFun of 1.000000e-04 


iterations =

    28

By this method using 28 iterations we get N(0)=1.598157e+00 and alpha_2 =7.012891e-01 as our best values for aproximation, with a total error of 9.9689

message =

fminsearch gives a better result with a difference of 0.003666 on the total error

</pre><img vspace="5" hspace="5" src="pop_14.png" alt=""> <h2>2.4 c)<a name="22"></a></h2><p>Comparing the 2 methods</p><pre class="codeinput">figure
h=plot(prey.tr,prey.yr,<span class="string">'o'</span>,<span class="string">'linewidth'</span>,2);  <span class="comment">%presas.mat plot</span>
hold <span class="string">on</span>;
h2=plot(clk_f,N1_f,<span class="string">'linewidth'</span>,2); <span class="comment">%fminsearch plot</span>
h1=plot(clk,N1,<span class="string">'linewidth'</span>,2); <span class="comment">%brute force plot</span>
grid <span class="string">on</span>;
grid <span class="string">minor</span>;
hold <span class="string">off</span>
</pre><img vspace="5" hspace="5" src="pop_15.png" alt=""> <p>Using the optimization algorithm fminsearch we can get the same approximate values by apllying 14 times less iterations</p><pre class="codeinput"><span class="keyword">end</span>



<span class="keyword">function</span> mod = sim_plot(alpha1,alpha2,StopTime,Step,N1_init,N2_init,file,delta1,delta2)

        delt1=num2str(delta1);
        term1_N1=strcat(delt1,<span class="string">'*u(1)'</span>);
        alpha1=num2str(alpha1);
        aux=strcat(<span class="string">'-'</span>,alpha1);
        term2_N1=strcat(aux,<span class="string">'*u(1)*u(2)'</span>);
        prey_fcn=strcat(term1_N1,term2_N1);

        delt2=num2str(delta2);
        term1_N2=strcat(delt2,<span class="string">'*u(2)'</span>);
        alpha2=num2str(alpha2);
        aux2=strcat(<span class="string">'+'</span>,alpha2);
        term2_N2=strcat(aux2,<span class="string">'*u(1)*u(2)'</span>);
        pred_fcn=strcat(term1_N2,term2_N2);

        N1_init=num2str(N1_init);
        N2_init=num2str(N2_init);

        set_param(file,<span class="string">'StopTime'</span>,StopTime);
        set_param(<span class="string">'popul/Integrator'</span>,<span class="string">'InitialCondition'</span>,N1_init);
        set_param(<span class="string">'popul/Integrator1'</span>,<span class="string">'InitialCondition'</span>,N2_init);

        set_param(<span class="string">'popul/Fcn1'</span>,<span class="string">'Expr'</span>,prey_fcn);
        set_param(<span class="string">'popul/Fcn2'</span>,<span class="string">'Expr'</span>,pred_fcn);
        set_param(file,<span class="string">'FixedStep'</span>,Step);
        mod=sim(file,<span class="string">'SimulationMode'</span>,<span class="string">'Normal'</span>);
<span class="keyword">end</span>

<span class="keyword">function</span> plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe)

        clk=mod.get(<span class="string">'clock'</span>);
        N2=mod.get(<span class="string">'dataN2'</span>);
        N1=mod.get(<span class="string">'dataN1'</span>);
        V=figure;
        h=plot(clk,N2,<span class="string">'linewidth'</span>,2);
        hold <span class="string">on</span>;
        h1=plot(clk,N1,<span class="string">'linewidth'</span>,2);
        xlabel(xaxe);
        ylabel(yaxe);
        title(tittle,<span class="string">'Interpreter'</span>,<span class="string">'tex'</span>);
        legend([h,h1],legenda1,legenda2);
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
        hold <span class="string">off</span>
<span class="keyword">end</span>

<span class="keyword">function</span> Z = error_matrix(alpha2_t,N2_t)
[X,Y]=meshgrid(alpha2_t,N2_t);
sz=size(X);
Z=zeros(sz(1),sz(2));
h = waitbar(0,<span class="string">'Please wait...'</span>);
<span class="keyword">for</span> i=1:sz(1)
    msg=num2str(i);
    <span class="keyword">for</span> j=1:sz(2)
        <span class="comment">%messagge box</span>
        msg1=num2str(j);
        msg1=strcat(msg1,<span class="string">' out of 20'</span>);
        str=strcat(msg,<span class="string">' out of 20 / '</span>);
        str=strcat(str,msg1);
        waitbar(i/sz(1),h,str);
        <span class="comment">%sim and ge error</span>
        x(2)=Y(i,j);
        x(1)=X(i,j);
        Z(i,j)=algorithm1(x);
    <span class="keyword">end</span>
<span class="keyword">end</span>
close(h)

<span class="keyword">end</span>

<span class="keyword">function</span> total_error= algorithm1(x)
    prey=load(<span class="string">'presas.mat'</span>);
    mod=sim_plot(1.4,x(1),<span class="string">'20'</span>,<span class="string">'0.1'</span>,<span class="string">'4'</span>,x(2),<span class="string">'popul'</span>,3.1,-1.5);
    N1=mod.get(<span class="string">'dataN1'</span>);
    total_error=0;
    <span class="keyword">for</span> i=1:size(prey.yr)
        erro= abs(prey.yr(i)-N1(i));
        total_error=total_error+erro;
    <span class="keyword">end</span>

<span class="keyword">end</span>


<span class="comment">% function dispIteration()</span>
<span class="keyword">function</span> create_mesh(Parent1, xdata1, ydata1, zdata1)
<span class="comment">%CREATEAXES(PARENT1, XDATA1, YDATA1, ZDATA1)</span>
<span class="comment">%  PARENT1:  axes parent</span>
<span class="comment">%  XDATA1:  surface xdata</span>
<span class="comment">%  YDATA1:  surface ydata</span>
<span class="comment">%  ZDATA1:  surface zdata</span>

<span class="comment">%  Auto-generated by MATLAB on 29-Mar-2018 16:10:25</span>

<span class="comment">% Create axes</span>
axes1 = axes(<span class="string">'Parent'</span>,Parent1);
hold(axes1,<span class="string">'on'</span>);

<span class="comment">% Create mesh</span>
mesh(xdata1,ydata1,zdata1,<span class="string">'Parent'</span>,axes1);

<span class="comment">% Create xlabel</span>
xlabel(<span class="string">'alpha2'</span>);

<span class="comment">% Create zlabel</span>
zlabel(<span class="string">'Total Error(%)'</span>);

<span class="comment">% Create title</span>
title(<span class="string">'Error calculation'</span>);

<span class="comment">% Create ylabel</span>
ylabel(<span class="string">'N2(0)'</span>);

colorbar;

view(axes1,[130.5 8.4000000000001]);
grid(axes1,<span class="string">'on'</span>);
<span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2016a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Study of populations  
% Here we evaluate a a physhical model of a car going forward taking in
% account different values of the contant of time which is given by the friction constant
% divided by mass

%% Load model
function pop

close all;
%Load file in system memory
file='popul';
load_system(file);
%% Variable Definition
StopTime='4';
N1_init='2';     
N2_init='2';     
alpha1=1;
alpha2=1;
legenda1='Predadator (N2)';
legenda2='Prey (N1)';
xaxe='Time (s)';
yaxe='[Predadator (N2),Prey (N1)]';

%Define strings to input into model


%% 2.1
% Simulations with $$\alpha_1 = \alpha_2 $$ and for various values of
% $$\sigma_1 $$ and $$\sigma_2 $$

%% 2.2
% With $$\alpha_1 = \alpha_2 = 1 $$ we evaluate the different types of evolution
% considering various values for $$\delta_1 $$ and $$\delta_2 $$

mod=sim_plot(alpha1,alpha2,'10','0.0001',N1_init,N2_init,file,-1,-1);
tittle='Interaction between the two populations with \delta_1 = -1 and \delta_2 = -1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = -1 $$ and $$\delta_2 = -1 $$  osccilates
mod=sim_plot(alpha1,alpha2,StopTime,'0.0001',N1_init,N2_init,file,-1,0);
tittle='Interaction between the two populations with \delta_1 = -1 and \delta_2 = 0';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = -1 $$ and $$\delta_2 = 0 $$ equilibrium
mod=sim_plot(alpha1,alpha2,'2','0.0001',N1_init,N2_init,file,-1,1);
tittle='Interaction between the two populations with \delta_1 = -1 and \delta_2 = 1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = -1 $$ and $$\delta_2 = 1 $$

mod=sim_plot(alpha1,alpha2,'10','0.0001',N1_init,N2_init,file,0,-1);
tittle='Interaction between the two populations with \delta_1 = 0 and \delta_2 = -1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 0 $$ and $$\delta_2 = -1 $$  osccilates
mod=sim_plot(alpha1,alpha2,StopTime,'0.0001',N1_init,N2_init,file,0,0);
tittle='Interaction between the two populations with \delta_1 = 0 and \delta_2 = 0';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 0 $$ and $$\delta_2 = 0 $$ equilibrium
mod=sim_plot(alpha1,alpha2,'2','0.0001',N1_init,N2_init,file,0,1);
tittle='Interaction between the two populations with \delta_1 = 0 and \delta_2 = 1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 0 $$ and $$\delta_2 = 1 $$

mod=sim_plot(alpha1,alpha2,'10','0.0001',N1_init,N2_init,file,1,-1);
tittle='Interaction between the two populations with \delta_1 = 1 and \delta_2 = -1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 1 $$ and $$\delta_2 = -1 $$  osccilates
mod=sim_plot(alpha1,alpha2,StopTime,'0.0001',N1_init,N2_init,file,1,0);
tittle='Interaction between the two populations with \delta_1 = 1 and \delta_2 = 0';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 1 $$ and $$\delta_2 = 0 $$ equilibrium
mod=sim_plot(alpha1,alpha2,'2','0.0001',N1_init,N2_init,file,1,1);
tittle='Interaction between the two populations with \delta_1 = 1 and \delta_2 = 1';
plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);
%%
% $$\delta_1 = 1 $$ and $$\delta_2 = 1 $$


%% 2.3
% To confirm equilibrium we need to assure that $$N_1 =
% -\frac{\delta_2}{\alpha_2} $$ and $$\frac{\delta_1}{\alpha_1} $$, so
% ploting the case where the populations osccilate i.e for every $$\delta_2
% < 0 $$ with $$\delta_1 >0 $$
    n1V=[1 2 3 4 5 6]
    n2V=[1 2 3 4 5 6]
    [X,Y]=meshgrid(n1V,n2V);
figure
grid on;
grid minor;
for k=1:6
    for j=1:6
        mod=sim_plot(alpha1,alpha2,'10','0.0001',X(k,j),Y(k,j),file,1,-1);
        N2p=mod.get('dataN2');
        N1p=mod.get('dataN1');
        plot(N1p,N2p,'linewidth',2);
        hold on;
        xlabel('N2 Population');
        ylabel('N1 Population');
        title('Phase Space with \delta_1 = 1 and \delta_2 = -1','Interpreter','tex');
        
    end
end
mod=sim_plot(alpha1,alpha2,'10','0.0001',1,1,file,1,-1);
N2p=mod.get('dataN2');
N1p=mod.get('dataN1');
plot(N1p,N2p,'x','linewidth',2);
hold off
%Por acabar
%%
% comentar que temos sempre o equilibrio se o ponto de equilibrio for
% satisfeito

%% 2.4 a)
% Here we plot presas.mat togeter with our best guess of values for the
% predadotr evolution
mod=sim_plot(1.4,0.71,'20','0.0001','4','1.47',file,3.1,-1.5);
%plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe);

prey=load('presas.mat');
h=plot(prey.tr,prey.yr,'linewidth',2);
N1=mod.get('dataN1');
clk=mod.get('clock');
hold on;
h1=plot(clk,N1,'linewidth',2);
grid on;
grid minor;
xlabel('Time (s)');
ylabel('N1 Population');
title('Approximation by visual guidance','Interpreter','tex');
legend([h,h1],'N1 given by file','N1 by visual approximation');
hold off
%%
% We can see by the maximum values of presas.mat that our values for the
% predadator function are a good estimate of the real ones

%% 2.4 b)
%

%Get linear spaced values for variables (400 iterations using 20 by 20 linear spaced)
alpha2_t=linspace(0.68,0.72,20);
N2_t=linspace(1.58,1.62,20);
[X,Y]=meshgrid(alpha2_t,N2_t);
%Z matrix contains the total error for each point of the grid
Z = error_matrix(alpha2_t,N2_t);

%Plot mesh figure
h=figure;
create_mesh(h,X,Y,Z);    %made by righ clicking the figure (../get code) because i rotated it to get a better view
%Get the min error value and index
I=find(Z==min(min(Z)));
Zmin=min(min(Z));
N2_init=num2str(Y(I));
alpha_2=num2str(X(I));

%Plot both prey evolution plot
mod=sim_plot(1.4,alpha_2,'20','0.0001','4',N2_init,file,3.1,-1.5);
N1=mod.get('dataN1');
clk=mod.get('clock');
figure
%plot presas.mat
h=plot(prey.tr,prey.yr,'linewidth',2);
hold on;
%plot sim and label
h1=plot(clk,N1,'linewidth',2);
xlabel('Time (s)');
ylabel('N1 Population');
title('Approximation by brute force','Interpreter','tex');
legend([h,h1],'N1 given by file','N1 by approximation');
grid on;
grid minor;
hold off;
%Get min value of error and point X,Y
N2_init=num2str(Y(I));
alpha_2=num2str(X(I));
Zmin_str=num2str(Zmin);
message=sprintf('By this method, using 400 iterations we get N(0)=%s and alpha_2 =%s as our best values for aproximation, with a total error of %s',N2_init,alpha_2,Zmin_str);
disp(message);

%%
% Using brute force iterations we see that we can get a really good
% approximation. But if we didnt knew the interval on where alpha2 and
% N2init were, we would get much more iteration. This method is not viable
% (continue)



%% 2.4 c)
% Optimization usig fminsearch

%x0 = initial values to begin optimization algorithm, fminsearch returns
%the solution fval (error in our case), x(1) and x(2) corresponding to
%N2_init and alpha_2
x0=[0.68;1.58];
options=optimset('Display','final');
[x,fval,exitflag,output]=fminsearch(@algorithm1,x0,options);
%get number of iterations it needed to find the min value
iterations=output.iterations
fval_str=num2str(fval);

message=sprintf('By this method using 28 iterations we get N(0)=%s and alpha_2 =%s as our best values for aproximation, with a total error of %s',x(2),x(1),fval_str);
disp(message);
%plot both prey evolution plots
N2_init=num2str(x(2));
alpha_2=num2str(x(1));
mod=sim_plot(1.4,alpha_2,'20','0.0001','4',N2_init,file,3.1,-1.5);
N1_f=mod.get('dataN1');
clk_f=mod.get('clock');
figure
h=plot(prey.tr,prey.yr,'linewidth',2);
hold on
h2=plot(clk_f,N1_f,'linewidth',2);
xlabel('Time (s)');
ylabel('N1 Population');
title('Approximation using optimization algorithm','Interpreter','tex');
legend([h,h2],'N1 given by file','N1 by approximation');
grid on;
grid minor;
hold off;

result=Zmin-fval;
if result<0
    message=sprintf('Brute force iteration gives a better result with a difference of %f on the total error',result)
elseif result > 0
    message=sprintf('fminsearch gives a better result with a difference of %f on the total error',result)
else
    message=sprintf('Both methonds give the same result, given the %f difference on the total error',result)
end

%% 2.4 c)
% Comparing the 2 methods

figure
h=plot(prey.tr,prey.yr,'o','linewidth',2);  %presas.mat plot
hold on;
h2=plot(clk_f,N1_f,'linewidth',2); %fminsearch plot
h1=plot(clk,N1,'linewidth',2); %brute force plot
grid on;
grid minor;
hold off


%%
% Using the optimization algorithm fminsearch we can get the same approximate values by
% apllying 14 times less iterations 


       






end



function mod = sim_plot(alpha1,alpha2,StopTime,Step,N1_init,N2_init,file,delta1,delta2)

        delt1=num2str(delta1);
        term1_N1=strcat(delt1,'*u(1)');
        alpha1=num2str(alpha1);
        aux=strcat('-',alpha1);
        term2_N1=strcat(aux,'*u(1)*u(2)');
        prey_fcn=strcat(term1_N1,term2_N1);

        delt2=num2str(delta2);
        term1_N2=strcat(delt2,'*u(2)');
        alpha2=num2str(alpha2);
        aux2=strcat('+',alpha2);
        term2_N2=strcat(aux2,'*u(1)*u(2)');
        pred_fcn=strcat(term1_N2,term2_N2);
        
        N1_init=num2str(N1_init);
        N2_init=num2str(N2_init);
        
        set_param(file,'StopTime',StopTime);
        set_param('popul/Integrator','InitialCondition',N1_init);
        set_param('popul/Integrator1','InitialCondition',N2_init);

        set_param('popul/Fcn1','Expr',prey_fcn);
        set_param('popul/Fcn2','Expr',pred_fcn);
        set_param(file,'FixedStep',Step);
        mod=sim(file,'SimulationMode','Normal');
end

function plot_pop(mod,tittle,legenda1,legenda2,xaxe,yaxe)

        clk=mod.get('clock');
        N2=mod.get('dataN2');
        N1=mod.get('dataN1');
        V=figure;
        h=plot(clk,N2,'linewidth',2); 
        hold on;
        h1=plot(clk,N1,'linewidth',2);
        xlabel(xaxe);
        ylabel(yaxe);
        title(tittle,'Interpreter','tex');
        legend([h,h1],legenda1,legenda2);
        grid on;
        grid minor;
        hold off
end

function Z = error_matrix(alpha2_t,N2_t)
[X,Y]=meshgrid(alpha2_t,N2_t);
sz=size(X);
Z=zeros(sz(1),sz(2));
h = waitbar(0,'Please wait...');
for i=1:sz(1)
    msg=num2str(i);
    for j=1:sz(2)
        %messagge box
        msg1=num2str(j);
        msg1=strcat(msg1,' out of 20');
        str=strcat(msg,' out of 20 / ');
        str=strcat(str,msg1);
        waitbar(i/sz(1),h,str);
        %sim and ge error
        x(2)=Y(i,j);
        x(1)=X(i,j);
        Z(i,j)=algorithm1(x);
    end
end
close(h)

end

function total_error= algorithm1(x)
    prey=load('presas.mat');
    mod=sim_plot(1.4,x(1),'20','0.1','4',x(2),'popul',3.1,-1.5);
    N1=mod.get('dataN1');
    total_error=0;
    for i=1:size(prey.yr)     
        erro= abs(prey.yr(i)-N1(i));
        total_error=total_error+erro;
    end
    
end


% function dispIteration()
function create_mesh(Parent1, xdata1, ydata1, zdata1)
%CREATEAXES(PARENT1, XDATA1, YDATA1, ZDATA1)
%  PARENT1:  axes parent
%  XDATA1:  surface xdata
%  YDATA1:  surface ydata
%  ZDATA1:  surface zdata

%  Auto-generated by MATLAB on 29-Mar-2018 16:10:25

% Create axes
axes1 = axes('Parent',Parent1);
hold(axes1,'on');

% Create mesh
mesh(xdata1,ydata1,zdata1,'Parent',axes1);

% Create xlabel
xlabel('alpha2');

% Create zlabel
zlabel('Total Error(%)');

% Create title
title('Error calculation');

% Create ylabel
ylabel('N2(0)');

colorbar;

view(axes1,[130.5 8.4000000000001]);
grid(axes1,'on');
end





##### SOURCE END #####
--></body></html>